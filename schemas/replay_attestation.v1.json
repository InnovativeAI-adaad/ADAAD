{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://adaad.local/schemas/replay_attestation.v1.json",
  "title": "Replay Attestation Bundle v1",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "epoch_id",
    "baseline_digest",
    "ledger_state_hash",
    "mutation_graph_fingerprint",
    "constitution_version",
    "sandbox_policy_hash",
    "checkpoint_chain",
    "checkpoint_chain_digest",
    "replay_digest",
    "canonical_digest",
    "policy_hashes",
    "proof_digest",
    "signature_bundle",
    "signatures"
  ],
  "properties": {
    "schema_version": {"type": "string", "const": "1.0"},
    "epoch_id": {"type": "string", "minLength": 1},
    "baseline_digest": {"type": "string", "pattern": "^sha256:[a-f0-9]{1,64}$"},
    "ledger_state_hash": {"type": "string", "pattern": "^sha256:[a-f0-9]{1,64}$"},
    "mutation_graph_fingerprint": {"type": "string", "pattern": "^sha256:[a-f0-9]{64}$"},
    "constitution_version": {"type": "string", "minLength": 1},
    "sandbox_policy_hash": {"type": "string", "pattern": "^sha256:[a-f0-9]{1,64}$"},
    "checkpoint_chain": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "checkpoint_id",
          "checkpoint_hash",
          "prev_checkpoint_hash",
          "epoch_digest",
          "baseline_digest",
          "created_at"
        ],
        "properties": {
          "checkpoint_id": {"type": "string", "minLength": 1},
          "checkpoint_hash": {"type": "string", "pattern": "^sha256:[a-f0-9]{64}$"},
          "prev_checkpoint_hash": {"type": "string", "pattern": "^sha256:[a-f0-9]{1,64}$"},
          "epoch_digest": {"type": "string", "pattern": "^sha256:[a-f0-9]{1,64}$"},
          "baseline_digest": {"type": "string", "pattern": "^sha256:[a-f0-9]{1,64}$"},
          "created_at": {"type": "string", "format": "date-time"}
        }
      }
    },
    "checkpoint_chain_digest": {"type": "string", "pattern": "^sha256:[a-f0-9]{64}$"},
    "replay_digest": {"type": "string", "pattern": "^sha256:[a-f0-9]{1,64}$"},
    "canonical_digest": {"type": "string", "pattern": "^[a-f0-9]{64}$"},
    "policy_hashes": {
      "type": "object",
      "additionalProperties": false,
      "required": ["promotion_policy_hash", "entropy_policy_hash", "sandbox_policy_hash"],
      "properties": {
        "promotion_policy_hash": {"type": "string", "pattern": "^sha256:[a-f0-9]{1,64}$"},
        "entropy_policy_hash": {"type": "string", "pattern": "^sha256:[a-f0-9]{1,64}$"},
        "sandbox_policy_hash": {"type": "string", "pattern": "^sha256:[a-f0-9]{1,64}$"}
      }
    },
    "trust_root_metadata": {
      "type": "object",
      "additionalProperties": false,
      "required": ["issuer_chain", "key_epoch", "revocation_reference", "trust_policy_version"],
      "properties": {
        "issuer_chain": {
          "type": "array",
          "minItems": 1,
          "items": {"type": "string", "minLength": 1}
        },
        "key_epoch": {
          "type": "object",
          "additionalProperties": false,
          "required": ["id", "valid_from", "valid_until"],
          "properties": {
            "id": {"type": "string", "minLength": 1},
            "valid_from": {"type": "string", "format": "date-time"},
            "valid_until": {"type": "string", "format": "date-time"}
          }
        },
        "revocation_reference": {
          "type": "object",
          "additionalProperties": false,
          "required": ["source", "reference"],
          "properties": {
            "source": {"type": "string", "minLength": 1},
            "reference": {"type": "string", "minLength": 1}
          }
        },
        "trust_policy_version": {"type": "string", "minLength": 1}
      }
    },
    "proof_digest": {"type": "string", "pattern": "^sha256:[a-f0-9]{64}$"},
    "signature_bundle": {
      "type": "object",
      "additionalProperties": false,
      "required": ["key_id", "algorithm", "signed_digest", "signature"],
      "properties": {
        "key_id": {"type": "string", "minLength": 1},
        "algorithm": {"type": "string", "minLength": 1},
        "signed_digest": {"type": "string", "pattern": "^sha256:[a-f0-9]{64}$"},
        "signature": {"type": "string", "minLength": 1}
      }
    },
    "signatures": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["key_id", "algorithm", "signed_digest", "signature"],
        "properties": {
          "key_id": {"type": "string", "minLength": 1},
          "algorithm": {"type": "string", "minLength": 1},
          "signed_digest": {"type": "string", "pattern": "^sha256:[a-f0-9]{64}$"},
          "signature": {"type": "string", "minLength": 1}
        }
      }
    }
  }
}
